<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link href="floatingicon.css" rel="stylesheet"> 
    <link href="index.css" rel="stylesheet">
    <!-- <script type="text/javascript" src="script.js" async></script> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Varma Clinic</title>
    <style>

.form-group {
            margin-top: 20px;
        }
        .date-picker-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        #appointment_date {
            padding-right: 30px;
            width: 100%;
        }
        #calendar-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #061053;
            font-size: 1.2em;
        }
        #calendar-icon:hover {
            color: #132074;
        }
        .flatpickr-calendar {
            z-index: 9999; /* Ensure it's on top of other content */
        }
        .flatpickr-calendar .flatpickr-day.flatpickr-disabled {
            background-color: #e0e0e0 !important;
            color: #9e9e9e !important;
            cursor: not-allowed;
        }
        .flatpickr-calendar .flatpickr-day.flatpickr-disabled:hover {
            background-color: #d5d5d5 !important;
        }
        .flatpickr-calendar .flatpickr-day {
            color: #4caf50;
        }
        .flatpickr-calendar .flatpickr-day:hover {
            background-color: #388e3c !important;
            color: black !important;
        }
        .flatpickr-calendar .flatpickr-day.selected {
            background-color: #4caf50 !important;
            color: black !important;
        }
        .flatpickr-calendar .flatpickr-day.today {
            border: 2px solid #4caf50;
        }
        .flatpickr-calendar .flatpickr-day:not(.flatpickr-disabled) {
            background-color: #c8e6c9 !important;
        }
        .form-container {
            padding: 20px;
            max-width: 800px;
            margin: auto;
        }
        .next-button {
            display: block;
            margin-bottom: 20px;
            color: #061053;
            text-decoration: none;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        /* .floating-contact {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .floating-contact img {
            width: 40px;
            height: 40px;
            margin: 0 5px;
        }
        .floating-contact a {
            display: inline-block;
        } */
        .error-message {
            color: red;
            display: none; /* Hide by default */
            font-size: 0.875em;
        }
        .disabled-button {
            background-color: #e0e0e0;
            cursor: not-allowed;
        }
        .enabled-button {
            background-color: #081a54;
            color: white;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-size: 18px;
        }
        input[type="date"] {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .slot {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:disabled {
            background-color: #ccc;
        }
        #available-slots {
    display: flex;
    flex-wrap: wrap;
    gap: 10px; /* Space between buttons */
}

.slot {
    flex: 1 1 calc(20% - 10px); /* 5 items per row, adjust the percentage as needed */
    display: flex;
    justify-content: center;
    align-items: center;
}

.slot button {
    font-size: 12px; /* Adjust font size as needed */
    padding: 8px 12px; /* Adjust button size as needed */
    margin: 0; /* Remove default margin */
}

    </style>
      <style>
        /* Button Container */
.button-container {
    display: flex;
    flex-direction: column;
    gap: 10px; /* Space between buttons */
    margin-top: 20px; /* Space above the button container */
}

/* General Button Styles */
button {
    padding: 10px 20px; /* Vertical and Horizontal padding */
    border: none;
    border-radius: 5px; /* Rounded corners */
    font-size: 16px; /* Font size */
    font-weight: bold; /* Bold text */
    cursor: pointer;
    transition: background-color 0.3s, transform 0.3s;
    width: 100%; /* Full width of the container */
}
#error-message {
    color: red;
    display: none;
}

input[type="radio"] {
    margin-right: 10px;
}

/* Default Button Style */
button.disabled-button {
    background-color: #e0e0e0;
    color: #9e9e9e;
    cursor: not-allowed;
}

/* Enabled Button Style */
button.enabled-button {
    background-color: #0c1d46; /* Green background */
    color: white;
}

/* Hover Effect */
button:not(.disabled-button):hover {
    background-color: #063151; /* Darker green on hover */
    transform: scale(1.05); /* Slightly increase size */
}

/* Focus Effect */
button:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(11, 27, 89, 0.5); /* Green outline for focus */
}
#available-slots {
            display: flex;
            flex-wrap: wrap;
            gap: 10px; /* Space between slots */
        }

    
    /* Container for slots */
    .slots-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px; /* Reduced space between slots */
        padding: 8px; /* Reduced padding around the container */
    }

    /* Individual slot styling */
    .slot {
        flex: 1 1 calc(25% - 8px); /* 4 slots in a row minus the gap */
        box-sizing: border-box;
        padding: 8px; /* Reduced padding inside slots */
        border: 1px solid #ddd;
        border-radius: 4px;
        text-align: center;
        font-size: 12px; /* Reduced font size */
        /* Optional: Add a background color for better visibility */
        background-color: #f8f9fa;
    }

    /* Button styling */
    .slot button {
        width: 100%;
        padding: 4px; /* Reduced padding inside button */
        font-size: 10px; /* Reduced font size */
        box-sizing: border-box; /* Include padding in button's width */
    }

    /* Media queries for responsive design */
    @media (max-width: 1200px) {
        .slot {
            flex: 1 1 calc(25% - 8px); /* 4 slots in a row */
        }
    }

    @media (max-width: 900px) {
        .slot {
            flex: 1 1 calc(25% - 8px); /* 4 slots in a row */
        }
    }

    @media (max-width: 600px) {
        .slot {
            flex: 1 1 calc(25% - 8px); /* 4 slots in a row */
        }
    }

    @media (max-width: 400px) {
        .slot {
            flex: 1 1 calc(50% - 8px); /* 2 slots in a row */
        }
    }

    /* Style for available slots */
    .slot button.available {
        background-color: #28a745; /* Green */
        color: white;
    }

    /* Style for booked slots */
    .slot button.booked {
        background-color: #dc3545; /* Red */
        color: white;
        cursor: not-allowed;
    }

    /* Style for unavailable slots */
    .slot button.unavailable {
        background-color: #6c757d; /* Grey */
        color: white;
        cursor: not-allowed;
    }



    /* General button style */
    .slot button {
        padding: 10px 20px;
        border: none;
        color: white;
        cursor: pointer;
        border-radius: 5px;
        font-size: 16px;
        margin: 5px;
    }
    
    /* Style for available slots */
    .slot button.available {
        background-color: #28a745; /* Green */
    }
    
    /* Style for booked slots */
    .slot button.booked {
        background-color: #beb4b5; /* Red */
        cursor: not-allowed;
    }
    
    /* Disabled class for booked slots */
    .slot button.disabled {
        background-color: #959192; /* Red */
        cursor: not-allowed;
    }
    /* Container for the slots */
.slots-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px; /* Space between slots */
    justify-content: center; /* Center align slots */
}

/* Individual slot */
.slot {
    flex: 1 1 calc(33.333% - 20px); /* Adjust width to fit three slots per row */
    min-width: 150px; /* Minimum width to avoid too small boxes */
    box-sizing: border-box;
    text-align: center;
}

/* Style for slot buttons */
.slot button {
    width: 100%; /* Fill the container width */
    padding: 10px;
    font-size: 14px; /* Adjusted font size */
    border: 1px solid #ddd;
    border-radius: 4px;
    background-color: #f5f5f5;
    cursor: pointer;
}

/* Style for available and booked slots */
.slot button.available {
    background-color: #4CAF50; /* Green for available */
    color: white;
}

.slot button.booked {
    background-color: #f44336; /* Red for booked */
    color: white;
    cursor: not-allowed;
}
@media (max-width: 800px) {
    .slot {
        flex: 1 1 calc(50% - 20px); /* Two slots per row on medium screens */
    }
}

@media (max-width: 500px) {
    .slot {
        flex: 1 1 calc(100% - 20px); /* One slot per row on small screens */
    }
}
/* Container for available slots */
.slots-container {
    margin-top: 10px; /* Space above the container */
    display: flex;
    flex-wrap: wrap; /* Allows slots to wrap to the next line if they overflow */
    gap: 1px; /* Reduce space between slots */
    max-height: calc(5 * (30px + 1px)); /* Ensure container fits 5 rows */
    overflow-y: auto; /* Allow scrolling if slots exceed the container height */
}

/* Adjust the container for each time slot */
.slot {
    flex: 1 1 calc(12.5% - 1px); /* Adjust width to fit 8 slots per row (100% / 8 ≈ 12.5%, minus gap) */
    box-sizing: border-box; /* Include padding and border in element's total width and height */
    padding: 0; /* Remove padding */
    margin: 0; /* Remove margin */
    min-height: 30px; /* Minimum height to ensure visibility */
}

/* Button style within each slot */
.slot button {
    display: block;
    width: 100%; /* Full width of the slot container */
    height: 100%; /* Full height of the slot container */
    padding: 2px; /* Adjusted padding inside the button */
    font-size: 8px; /* Smaller font size */
    background-color: #f0f0f0; /* Background color of the button */
    border: none; /* Remove default button border */
    border-radius: 0; /* No border radius for a flat appearance */
    cursor: pointer; /* Pointer cursor on hover */
    transition: background-color 0.3s, opacity 0.3s; /* Smooth transition for background color and opacity */
}

/* Styles for available slots */
.slot button.available {
    background-color: #dff0d8; /* Light green for available slots */
}

/* Styles for booked slots */
.slot button.booked {
    background-color: #f2dede; /* Light red for booked slots */
    cursor: not-allowed; /* Not-allowed cursor for booked slots */
    opacity: 0.6; /* Slightly transparent */
}

  /* Container for the available slots */
#available-slots {
    display: grid;
    grid-template-columns: repeat(8, 1fr); /* 7 columns in a row */
    gap: 5px; /* Space between slots */
    padding: 10px; /* Add padding around the container */
    max-width: 100%; /* Ensure it fits the container width */
    max-height: 80vh; /* Limit height to 80% of viewport height */
    box-sizing: border-box; /* Include padding in width and height calculation */
    overflow-y: auto; /* Enable vertical scrolling if needed */
    overflow-x: hidden; /* Prevent horizontal scrolling */
    position: relative; /* Relative positioning to help with aspect ratio */
}

/* Individual slot styling */
.slot {
    position: relative; /* Allows absolute positioning of the button */
    width: 100%; /* Make slot fill the grid cell */
    padding-top: 100%; /* Aspect ratio of 1:1 (square) */
    box-sizing: border-box; /* Include padding in width and height calculation */
    
}

/* Button styling */
.slot button {
    position: absolute; /* Position button absolutely within the slot */
    top: 0;
    left: 0;
    width: 100%; /* Make button fill the slot */
    height: 100%; /* Make button fill the slot */
    padding: 0; /* Remove internal padding */
    border: 1px solid #ccc; /* Border to define button boundaries */
    border-radius: 8px; /* Rounded corners, adjust as needed */
    background-color: #f0f0f0;
    cursor: pointer;
    font-size: 12px; /* Smaller font size */
    text-align: center; /* Center text in the button */
    box-sizing: border-box; /* Include padding and border in button size */
}

/* Available and booked slot styles */
.slot button.available {
    background-color: #4caf50; /* Green for available slots */
    color: white;
}

.slot button.booked {
    background-color: #f44336; /* Red for booked slots */
    color: white;
    cursor: not-allowed; /* Indicate that the slot cannot be clicked */
}

/* Optional: Style for action buttons (WhatsApp, SMS, Email, Call) */
button {
    padding: 8px 12px; /* Smaller padding */
    font-size: 14px; /* Adjust font size for action buttons */

}

/* Page styling */
html, body {
    margin: 0;
    padding: 0;
    overflow: auto; /* Allow page to scroll if needed */
    width: 100vw; /* Ensure the body width fits the viewport */
    height: 100vh; /* Ensure the body height fits the viewport */
}

</style>   
    

</head>
<body>
    
    <div class="form-container">
        <a href="index1.html" class="next-button">Calendely</a>
        <img src="images/logo.png" width="620" height="100" alt="Form Logo" />
        <h1>Book Your Appointment</h1>
        <form id="appointmentForm">
            <div class="form-group">
                <label for="name">Patient Name:</label>
                <input type="text" id="name" name="name" required placeholder="Enter name" oninput="validateForm()">
                <small id="nameError" class="error-message">Please enter a valid name (alphabets only).</small>
            </div>
            <div class="form-group">
                <label for="age">Age:</label>
                <input type="number" id="age" name="age" required placeholder="Enter age" oninput="validateForm()">
                <small id="ageError" class="error-message">Please enter a valid age (1-110 and up to 3 digits).</small>
            </div>
            <div class="form-group">
                <label for="gender" style="margin-top: 20px;">Gender:</label>
                <select id="gender" name="gender" required onchange="validateForm()">
                    <option value="">Please Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Transgender">Transgender</option>
                </select>
            </div>
            <div class="form-group" style="margin-top: 20px;">
                <label for="phone" style="margin-top: 20px;">Mobile Number:</label>
                <input type="tel" class="form-control" name="Mobile number" id="phone" placeholder=""
                       oninput="validateForm()" pattern="[6-9][0-9]{9}" maxlength="10" required>
                <small id="phoneError" class="error-message">Phone number must start with 6-9 and be 10 digits long.</small>
            </div>
            <div class="form-group">
                <label for="reason" style="margin-top: 20px;">Reason For Your Appointment:</label>
                <select id="reason" name="reason" required onchange="validateForm()">
                    <option value="">Please Select</option>
                    <option value="Fever">Fever</option>
                    <option value="Vomiting">Vomiting</option>
                    <option value="Head Ache">Head Ache</option>
                    <option value="Diarrhoea/Dysentery">Diarrhoea/Dysentery</option>
                    <option value="Stomach Pain">Stomach Pain</option>
                    <option value="Body pain/Joint pain">Body pain/Joint pain</option>
                    <option value="Others">Others</option>
                </select>
            </div>
            <div class="form-group">
                <label for="date">Select Date:</label>
                <input type="date" id="date" onchange="loadSlots()">
                <div id="available-slots" class="slots-container">
                    <!-- Available slots will be dynamically loaded here -->
                </div>
            </div>
            
            
          
<!-- Communication Options -->
<form id="submit_form_whatsapp">
    <div class="form-group">
        <button type="button" id="whatsappButton" style="margin-top: 20px;" onclick="redirectToWhatsApp()" disabled>Book an Appointment via WhatsApp</button>
    </div>
</form>

<form id="submit_form_sms">
    <div class="form-group">
        <button type="button" id="smsButton" style="margin-top: 20px;" onclick="redirectToSMS()" disabled>Book an Appointment via SMS</button>
    </div>
</form>

<form id="submit_form_email">
    <div class="form-group">
        <button type="button" id="emailButton" style="margin-top: 20px;" onclick="redirectToEmail()" disabled>Book an Appointment via Email</button>
    </div>
</form>

<form id="submit_form_call">
    <div class="form-group">
        <button type="button" id="callButton" style="margin-top: 20px;" onclick="redirectToCall()" disabled>Book an Appointment via Phone Call</button>
    </div>
</form>

<div class="container">
    <div class="floating-contact right">
        <a href="https://wa.me/9094852653" target="_blank">
            <img src="images/whats.png" alt="WhatsApp Icon">
        </a>
        <a href="mailto:balavarmaclinic@gmail.com?subject=Appointment%20Request" target="_blank">
            <img src="images/mail.png" alt="Email Icon">
        </a>
        <a href="sms:9094852653?body=Hello%20there!" target="_blank">
            <img src="images/message.png" alt="Message Icon">
        </a>
        <a href="tel:9094852653" target="_blank">
            <img src="images/call.png" alt="Call Icon">
        </a>
    </div>
</div>

   <script>
           function validatePhoneNumber() {
            const phoneInput = document.getElementById("phone");
            const phoneError = document.getElementById("phoneError");
            const phoneValue = phoneInput.value;

            const phonePattern = /^[6-9][0-9]{9}$/;

            if (phonePattern.test(phoneValue)) {
                phoneError.style.display = "none";
            } else {
                phoneError.style.display = "block";
            }
        }

        function restrictAgeInput() {
            const ageInput = document.getElementById("age");
            const ageError = document.getElementById("ageError");
            let value = ageInput.value;

            value = value.replace(/\D/g, '');

            const age = parseInt(value, 10);

            if (value.length > 3 || age < 1 || age > 110) {
                ageError.style.display = "block";
                ageInput.value = '';
            } else {
                ageError.style.display = "none";
                ageInput.value = value;
            }
        }

        function restrictNameInput() {
            const nameInput = document.getElementById("name");
            const nameError = document.getElementById("nameError");
            let value = nameInput.value;

            value = value.replace(/[^a-zA-Z\s]/g, '');
            nameInput.value = value;

            if (value === "") {
                nameError.style.display = "block";
            } else {
                nameError.style.display = "none";
            }
        }

        function validateForm() {
            const name = document.getElementById("name").value.trim();
            const age = document.getElementById("age").value.trim();
            const gender = document.getElementById("gender").value;
            const phone = document.getElementById("phone").value.trim();
            const reason = document.getElementById("reason").value;
            const appointmentDate = document.getElementById("appointment_date").value;
            const timeSlot = document.getElementById("time_slot").value;

            const nameValid = name !== "" && /^[a-zA-Z\s]+$/.test(name);
            const ageValid = age !== "" && /^[1-9][0-9]?$|^1[0-1][0-9]$/.test(age);
            const phoneValid = /^[6-9][0-9]{9}$/.test(phone);
            const genderValid = gender !== "";
            const reasonValid = reason !== "";
            const appointmentDateValid = appointmentDate !== "";
            const timeSlotValid = timeSlot !== "";

            const allValid = nameValid && ageValid && phoneValid && genderValid && reasonValid && appointmentDateValid && timeSlotValid;

            document.getElementById("whatsappButton").disabled = !allValid;
            document.getElementById("smsButton").disabled = !allValid;
            document.getElementById("emailButton").disabled = !allValid;
            document.getElementById("callButton").disabled = !allValid;
            document.getElementById("formspreeButton").disabled = !allValid;
        }

        document.getElementById("name").addEventListener("input", function() {
            restrictNameInput();
            validateForm();
        });

        document.getElementById("age").addEventListener("input", function() {
            restrictAgeInput();
            validateForm();
        });

        document.getElementById("phone").addEventListener("input", function() {
            validatePhoneNumber();
            validateForm();
        });

        document.getElementById("gender").addEventListener("change", validateForm);
        document.getElementById("reason").addEventListener("change", validateForm);
        document.getElementById("appointment_date").addEventListener("change", validateForm);
        document.getElementById("time_slot").addEventListener("change", validateForm);

    </script>
    <script>
    // Main function to load available time slots for a selected date
    async function loadSlots() {
        const dateInput = document.getElementById('date').value;
        if (!dateInput) {
            alert('Please select a date.');
            return;
        }

        const formattedDate = formatDateToYYYYMMDD(dateInput);
        console.log(`Fetching slots for date: ${formattedDate}`); // Debug log

        try {
            const response = await fetch('https://raw.githubusercontent.com/Balagangadara/timeblock/main/time.json');

            if (!response.ok) {
                throw new Error(`Network response was not ok: ${response.statusText}`);
            }

            const data = await response.json();
            console.log('Data fetched:', data); // Debug log

            const dayData = data[formattedDate];
            if (!dayData || !Array.isArray(dayData)) {
                document.getElementById('available-slots').innerHTML = '<p>No time slots available for this date.</p>';
                return;
            }

            const container = document.getElementById('available-slots');
            container.innerHTML = ''; // Clear existing slots

            let bookedSlots = JSON.parse(localStorage.getItem('bookedSlots') || '{}');
            bookedSlots = bookedSlots[formattedDate] || [];

            let selectedSlotId = localStorage.getItem('selectedSlotId');

            // Get current date and time
            const now = new Date();
            const currentTime = now.getHours() * 100 + now.getMinutes(); // Current time in HHMM format
            const today = formatDateToYYYYMMDD(now);

            dayData.forEach(slot => {
                if (!slot || typeof slot !== 'object') {
                    console.warn('Invalid slot data:', slot);
                    return;
                }

                const slotTime = parseInt(slot.time.replace(':', ''), 10); // Convert slot time to HHMM format
                const isPastSlot = (formattedDate === today && slotTime < currentTime) || (formattedDate !== today && formattedDate < today);

                // Create and configure slot button
                const slotButton = createSlotButton(slot, bookedSlots, selectedSlotId, isPastSlot);
                container.appendChild(slotButton);

                // Automatically select the first available slot if none is selected
                if (!selectedSlotId && !bookedSlots.includes(slot.id) && !isPastSlot) {
                    selectedSlotId = slot.id;
                    localStorage.setItem('selectedSlotId', selectedSlotId);
                    updateSlotButtons(formattedDate, selectedSlotId, slot.time);
                }
            });

            loadFormData();
            updateButtonStates();

        } catch (error) {
            console.error('Error loading slots:', error);
            document.getElementById('available-slots').innerHTML = `<p>Error loading slots: ${error.message}. Please try again later.</p>`;
        }
    }

       // Function to create slot buttons
    function createSlotButton(slot, bookedSlots, selectedSlotId, isPastSlot) {
        const slotButton = document.createElement('button');
        const isBooked = slot.booked || bookedSlots.includes(slot.id) || isPastSlot;

        // Set the button class and disable state based on whether the slot is booked or not
        slotButton.className = isBooked ? 'booked' : 'available';
        slotButton.disabled = isBooked;

        // Only display the time on the button
        slotButton.textContent = slot.time;
        slotButton.dataset.slotId = slot.id;
        slotButton.dataset.slotTime = slot.time;

        slotButton.addEventListener('click', function (event) {
            event.preventDefault(); // Prevent default behavior
            event.stopPropagation(); // Prevent event bubbling

            if (!isBooked) {
                handleSlotClick(slot.id, slot.time);
            }
        });

        return slotButton;
    }
    
        // Function to handle slot click
        function handleSlotClick(slotId, slotTime) {
            // Save the selected slot ID to local storage
            localStorage.setItem('selectedSlotId', slotId);
    
            // Update the UI to reflect the selection
            updateSlotButtons(formatDateToYYYYMMDD(document.getElementById('date').value), slotId, slotTime);
    
            // Enable or disable communication buttons based on form and slot selection
            updateButtonStates();
        }
    
       // Function to update slot buttons based on selection
    function updateSlotButtons(date, slotId, slotTime) {
        const slots = document.querySelectorAll('#available-slots .slot button');
        slots.forEach(button => {
            const buttonId = button.dataset.slotId;
            if (buttonId === slotId.toString()) {
                button.disabled = false; // Always enable selected slot
                button.className = 'selected'; // Apply selected class
                button.textContent = slotTime; // Show only time for selected slot
            } else {
                button.className = 'available'; // Ensure other buttons are available
                button.disabled = false;
                button.textContent = button.dataset.slotTime; // Show available slot time
            }
        });
    }
    function updateButtonStates() {
            const bookedSlots = JSON.parse(localStorage.getItem('bookedSlots') || '{}');
            const dateInput = document.getElementById('date')?.value;
    
            if (dateInput) {
                const formattedDate = formatDateToYYYYMMDD(dateInput);
                const slots = document.querySelectorAll('#available-slots .slot button');
                const dateBookedSlots = bookedSlots[formattedDate] || [];
                const selectedSlotId = localStorage.getItem('selectedSlotId');
    
                slots.forEach(button => {
                    const buttonIdMatch = button.getAttribute('onclick')?.match(/(\d+)/);
                    if (buttonIdMatch) {
                        const slotId = parseInt(buttonIdMatch[1], 10);
                        const slotTime = button.textContent.match(/\((.*?)\)/)?.[1] || ''; // Extract time
                        const isBooked = bookedSlots[formattedDate] && bookedSlots[formattedDate].includes(slotId);
                        button.disabled = isBooked;
                        button.className = isBooked ? 'booked' : 'available';
                        button.textContent = isBooked ? `Booked (${slotTime})` : `Available (${slotTime})`;
                    }
                });
    
                // Enable or disable communication buttons based on form and slot selection
                if (isFormComplete() && selectedSlotId) {
                    enableCommunicationButtons();
                } else {
                    disableCommunicationButtons();
                }
            }
        }
    
        // Function to check if the form is complete
        function isFormComplete() {
            const name = document.getElementById('name')?.value.trim();
            const age = document.getElementById('age')?.value.trim();
            const gender = document.getElementById('gender')?.value;
            const phone = document.getElementById('phone')?.value.trim();
            const reason = document.getElementById('reason')?.value;
            const date = document.getElementById('date')?.value;
            const selectedSlot = localStorage.getItem('selectedSlotId');
    
            return name && age && gender && phone && reason && date && selectedSlot;
        }
    
    
        // Function to setup event listeners
        function setupEventListeners() {
            const inputs = document.querySelectorAll('#name, #age, #gender, #phone, #reason, #date');
            inputs.forEach(input => {
                input.addEventListener('input', function () {
                    saveFormData(); // Save form data on every input change
                    updateButtonStates(); // Update button states on every input change
                });
            });
    
            document.getElementById('date')?.addEventListener('change', function () {
                loadSlots(); // Reload slots when the date changes
            });
        }
    
        // Call setupEventListeners to initialize event listeners
        setupEventListeners();
    
        // Function to save form data to localStorage
        function saveFormData() {
            const formData = {
                name: document.getElementById('name')?.value.trim(),
                age: document.getElementById('age')?.value.trim(),
                gender: document.getElementById('gender')?.value,
                phone: document.getElementById('phone')?.value.trim(),
                reason: document.getElementById('reason')?.value,
                date: document.getElementById('date')?.value // Save the raw date format
            };
            localStorage.setItem('formData', JSON.stringify(formData));
        }
    
        function loadFormData() {
            const formData = JSON.parse(localStorage.getItem('formData'));
            if (formData) {
                document.getElementById('name').value = formData.name;
                document.getElementById('age').value = formData.age;
                document.getElementById('gender').value = formData.gender;
                document.getElementById('phone').value = formData.phone;
                document.getElementById('reason').value = formData.reason;
                document.getElementById('date').value = formData.date; // Load the raw date format
            }
            updateButtonStates(); // Check button states when loading form data
        }
    
        function enableCommunicationButtons() {
            document.getElementById('whatsappButton').disabled = false;
            document.getElementById('smsButton').disabled = false;
            document.getElementById('emailButton').disabled = false;
            document.getElementById('callButton').disabled = false;
        }
    
        function disableCommunicationButtons() {
            document.getElementById('whatsappButton').disabled = true;
            document.getElementById('smsButton').disabled = true;
            document.getElementById('emailButton').disabled = true;
            document.getElementById('callButton').disabled = true;
        }
    
        function formatDateToYYYYMMDD(dateInput) {
            const date = new Date(dateInput);
            if (isNaN(date.getTime())) return 'Invalid Date';
            const year = date.getFullYear();
            const month = ('0' + (date.getMonth() + 1)).slice(-2);
            const day = ('0' + date.getDate()).slice(-2);
            return `${year}-${month}-${day}`;
        }
    
        function formatDateToDDMMYYYY(dateInput) {
            const date = new Date(dateInput);
            if (isNaN(date.getTime())) return 'Invalid Date';
            const day = ('0' + date.getDate()).slice(-2);
            const month = ('0' + (date.getMonth() + 1)).slice(-2);
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
    
        function getSelectedTimeSlot() {
            const slotId = localStorage.getItem('selectedSlotId');
            if (slotId) {
                const slots = document.querySelectorAll('#available-slots .slot button');
                for (let button of slots) {
                    if (button.dataset.slotId === slotId) {
                        return button.dataset.slotTime;
                    }
                }
            }
            return 'No time selected';
        }
    
        function getFormattedMessage() {
            const formData = JSON.parse(localStorage.getItem('formData'));
            if (!formData) {
                alert('Form data is missing.');
                return '';
            }
    
            const { name, age, gender, phone, reason, date } = formData;
            const formattedDate = formatDateToDDMMYYYY(date);
            const time = getSelectedTimeSlot();
    
            return `Name: ${name}\nAge: ${age}\nGender: ${gender}\nMobile Number: ${phone}\nReason For Appointment: ${reason}\nAppointment Date: ${formattedDate}\nTime Slot: ${time}`;
        }
    
        function redirectToWhatsApp() {
            const message = getFormattedMessage();
            const url = `https://wa.me/9094852653?text=${encodeURIComponent(message)}`;
            clearFormData(); // Clear form data after redirect
            window.open(url, '_blank');
        }
    
        function redirectToSMS() {
            const message = getFormattedMessage();
            const url = `sms:9094852653?body=${encodeURIComponent(message)}`;
            clearFormData(); // Clear form data after redirect
            window.open(url, '_blank');
        }
    
        function redirectToEmail() {
            const subject = 'Appointment Details';
            const body = getFormattedMessage();
            const url = `mailto:balavarmaclinic@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            clearFormData(); // Clear form data after redirect
            window.open(url, '_blank');
        }
    
        function redirectToCall() {
            const phoneNumber = '9094852653'; // Hardcoded phone number
            const url = `tel:${encodeURIComponent(phoneNumber)}`;
            clearFormData(); // Clear form data after redirect
            window.open(url, '_blank');
        }
    
        function clearFormData() {
            // Clear localStorage data
            localStorage.removeItem('formData');
            localStorage.removeItem('selectedSlotId');
            localStorage.removeItem('bookedSlots');
            
            // Clear form fields
            document.getElementById('name').value = '';
            document.getElementById('age').value = '';
            document.getElementById('gender').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('reason').value = '';
            document.getElementById('date').value = '';
            
            // Disable communication buttons
            disableCommunicationButtons();
        }
    </script>
    
    
    </script>
    
<style>
    /* Container for the available slots */
    #available-slots {
      display: grid;
      grid-template-columns: repeat(6, 1fr); /* 6 columns in a row */
      gap: 5px; /* Space between slots */
      padding: 10px; /* Add padding around the container */
      max-width: 100%; /* Ensure it fits the container width */
      max-height: 80vh; /* Limit height to 80% of viewport height */
      box-sizing: border-box; /* Include padding in width and height calculation */
      overflow-y: auto; /* Enable vertical scrolling if needed */
      overflow-x: hidden; /* Prevent horizontal scrolling */
      position: relative; /* Relative positioning to help with aspect ratio */
    }
  
    /* Individual slot styling */
    .slot {
      position: relative; /* Allows absolute positioning of the button */
      width: 100%; /* Make slot fill the grid cell */
      padding-top: 100%; /* Aspect ratio of 1:1 (square) */
      box-sizing: border-box; /* Include padding in width and height calculation */
    }
  
    /* Button styling */
    .slot button {
      position: absolute; /* Position button absolutely within the slot */
      top: 0;
      left: 0;
      width: 100%; /* Make button fill the slot */
      height: 100%; /* Make button fill the slot */
      padding: 0; /* Remove internal padding */
      border: 1px solid #ccc; /* Border to define button boundaries */
      border-radius: 8px; /* Rounded corners, adjust as needed */
      background-color: #f0f0f0;
      cursor: pointer;
      font-size: 12px; /* Smaller font size */
      text-align: center; /* Center text in the button */
      box-sizing: border-box; /* Include padding and border in button size */
      display: flex;
      align-items: center;
      justify-content: center;
    }
  
    /* Available and booked slot styles */
    .slot button.available {
      background-color: #4caf50; /* Green for available slots */
      color: white;
    }
  
    .slot button.booked {
      background-color: #f44336; /* Red for booked slots */
      color: white;
      cursor: not-allowed; /* Indicate that the slot cannot be clicked */
    }
  
    /* Optional: Style for action buttons (WhatsApp, SMS, Email, Call) */
    button {
      padding: 8px 12px; /* Smaller padding */
      font-size: 14px; /* Adjust font size for action buttons */
    }
  
    /* Page styling */
    html, body {
      margin: 0;
      padding: 0;
      overflow: auto; /* Allow page to scroll if needed */
      width: 100vw; /* Ensure the body width fits the viewport */
      height: 100vh; /* Ensure the body height fits the viewport */
    }
  </style>
  

<script>
    document.addEventListener('DOMContentLoaded', () => {
        setDateInputMinDate();
    });

    function setDateInputMinDate() {
        const dateInput = document.getElementById('date');
        if (!dateInput) return;

        // Get today's date in YYYY-MM-DD format
        const today = new Date().toISOString().split('T')[0];
        dateInput.setAttribute('min', today);
    }
</script>
</body>
</html>