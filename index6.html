<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="floatingicon.css" rel="stylesheet"> 
    <link href="index.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <script type="text/javascript" src="time.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Varma Clinic</title>
    <style>
        .slot-button {
            display: inline-block;
            margin: 5px;
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .slot-button.booked {
            background-color: #CCCCCC;
            cursor: not-allowed;
        }
        .slot-button:disabled {
            background-color: #CCCCCC;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <a href="index1.html" class="next-button" style="background-color: rgb(2, 7, 55); color: whitesmoke;">Next</a>
        <img src="images/logo.png" width="620" height="100" alt="Form Logo" />
        <h1>Book Your Appointment</h1>
        <form id="appointmentForm">
            <div class="form-group">
                <label for="name">Patient Name:</label>
                <input type="text" id="name" name="name" required placeholder="Enter name">
                <small id="nameError" class="error-message">Please enter a valid name (alphabets only).</small>
            </div>
            <div class="form-group">
                <label for="age">Age:</label>
                <input type="number" id="age" name="age" required placeholder="Enter age">
                <small id="ageError" class="error-message">Please enter a valid age (1-110 and up to 3 digits).</small>
            </div>
            <div class="form-group">
                <label for="gender" style="margin-top: 20px;">Gender:</label>
                <select id="gender" name="gender" required>
                    <option value="">Please Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Transgender">Transgender</option>
                </select>
            </div>
            <div class="form-group" style="margin-top: 20px;">
                <label for="phone">Mobile Number:</label>
                <input type="tel" id="phone" name="phone" required placeholder="" pattern="[6-9][0-9]{9}" maxlength="10">
                <small id="phoneError" class="error-message">Phone number must start with 6-9 and be 10 digits long.</small>
            </div>
            <div class="form-group">
                <label style="margin-top: 20px; padding-bottom: 15px;">Reason For Your Appointment:</label>
                <div class="reason-container">
                    <!-- Existing checkbox items -->
                    <div class="checkbox-item">
                        <label>
                            <input type="checkbox" name="reason" value="Fever"> Fever
                        </label>
                    </div>
                    <!-- Add other checkboxes as needed -->
                    <div class="checkbox-item others-input-container">
                        <label>
                            <input type="checkbox" name="reason" value="Others" id="othersCheckbox"> Others
                        </label>
                        <input type="text" id="othersInput" maxlength="20" style="display:none;" placeholder="Type here...">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="appointment_date">Select Date:</label>
                <input type="date" id="appointment_date" required>
                <div id="available-slots">
                    <!-- Available slots will be dynamically loaded here -->
                </div>
            </div>
            <div class="form-group">
                <button type="button" id="generateAppointmentLink" onclick="generateAppointmentLink()" disabled>Generate Appointment Link</button>
            </div>
        </form>
        <div class="appointment-buttons">
            <button type="button" id="whatsappButton" onclick="redirectToWhatsApp()" disabled>
                <i class="fab fa-whatsapp" style="color: #25D366;"></i> <!-- WhatsApp Green -->
            </button>
            <button type="button" id="smsButton" onclick="redirectToSMS()" disabled>
                <i class="fas fa-sms" style="color: #007BFF;"></i> <!-- SMS Blue -->
            </button>
            <button type="button" id="emailButton" onclick="redirectToEmail()" disabled>
                <i class="fas fa-envelope" style="color: #FF5722;"></i> <!-- Email Orange -->
            </button>
            <button type="button" id="callButton" onclick="redirectToCall()">
                <i class="fas fa-phone" style="color: #4CAF50;"></i> <!-- Phone Green -->
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Function to fetch available slots from a JSON file or API
async function fetchSlots(date) {
    const slotsURL = 'https://github.com/Varmaclinic/blocked-dates/main/blocked-dates.json'; // Update this with the correct path to your JSON file
    try {
        const response = await fetch(slotsURL);
        if (!response.ok) throw new Error('Network response was not ok.');
        const data = await response.json();
        return data.filter(slot => slot.date === date); // Filter slots by the selected date
    } catch (error) {
        console.error('Error fetching slots:', error);
        return [];
    }
}

// Function to format the date in YYYY-MM-DD format
function formatDate(date) {
    return date.toISOString().split('T')[0];
}

// Initialize Flatpickr date picker and set up event handlers
async function initializeDatePicker() {
    const today = new Date();
    const nextSevenDays = new Date(today);
    nextSevenDays.setDate(today.getDate() + 7);

    flatpickr("#appointment_date", {
        dateFormat: "Y-m-d",
        minDate: formatDate(today),
        maxDate: formatDate(nextSevenDays),
        onChange: async function(selectedDates) {
            const selectedDate = formatDate(selectedDates[0]);
            await loadTimeSlots(selectedDate);
            validateForm();
        }
    });
}

// Load time slots for the selected date and display them
async function loadTimeSlots(selectedDate) {
    const slots = await fetchSlots(selectedDate);

    const timeSlotsContainer = document.getElementById('available-slots');
    timeSlotsContainer.innerHTML = ''; // Reset container

    if (slots.length === 0) {
        timeSlotsContainer.innerHTML = '<p>No available slots for this date.</p>';
        document.getElementById('generateAppointmentLink').disabled = true;
        return;
    }

    slots.forEach(slot => {
        const button = document.createElement('button');
        button.textContent = slot.time;
        button.className = 'slot-button';
        button.disabled = slot.booked;
        button.onclick = () => {
            handleSlotSelection(slot);
        };

        if (slot.booked) {
            button.classList.add('booked');
        }

        timeSlotsContainer.appendChild(button);
    });
}

// Handle slot selection by enabling the Generate Appointment Link button
function handleSlotSelection(slot) {
    // Save the selected slot or update the form
    document.getElementById('generateAppointmentLink').disabled = false;
}

// Validate form fields and enable/disable the Generate Appointment Link button
function validateForm() {
    const name = document.getElementById("name").value.trim();
    const age = document.getElementById("age").value.trim();
    const gender = document.getElementById("gender").value;
    const phone = document.getElementById("phone").value.trim();
    const reason = document.querySelector('input[name="reason"]:checked') ? true : false;
    const appointmentDate = document.getElementById("appointment_date").value;
    const slotSelected = document.querySelector('.slot-button:not([disabled])') ? true : false;

    const nameValid = name !== "" && /^[a-zA-Z\s]+$/.test(name);
    const ageValid = age !== "" && /^[1-9][0-9]?$|^1[0-1][0-9]$/.test(age);
    const phoneValid = /^[6-9][0-9]{9}$/.test(phone);
    const genderValid = gender !== "";
    const appointmentDateValid = appointmentDate !== "";

    document.getElementById("generateAppointmentLink").disabled = !(nameValid && ageValid && genderValid && phoneValid && reason && appointmentDateValid && slotSelected);
}

// Event listeners to validate form inputs as they are changed
document.getElementById("name").addEventListener("input", validateForm);
document.getElementById("age").addEventListener("input", validateForm);
document.getElementById("gender").addEventListener("change", validateForm);
document.getElementById("phone").addEventListener("input", validateForm);
document.querySelectorAll('input[name="reason"]').forEach(input => input.addEventListener("change", validateForm));
document.getElementById("appointment_date").addEventListener("change", validateForm);

// Show or hide the "Others" input field based on checkbox selection
document.getElementById("othersCheckbox").addEventListener("change", function() {
    document.getElementById("othersInput").style.display = this.checked ? 'inline' : 'none';
    validateForm();
});

// Generate the appointment link or handle form submission
function generateAppointmentLink() {
    // Add your logic to generate or handle the appointment link
    alert('Generating appointment link...');
}

// Redirect to WhatsApp with a predefined message
function redirectToWhatsApp() {
    // Replace with your actual WhatsApp link
    window.location.href = 'https://wa.me/1234567890?text=Your%20message';
}

// Redirect to SMS with a predefined message
function redirectToSMS() {
    // Replace with your actual SMS link
    window.location.href = 'sms:1234567890?body=Your%20message';
}

// Redirect to email with a predefined subject
function redirectToEmail() {
    // Replace with your actual email link
    window.location.href = 'mailto:example@example.com?subject=Appointment%20Request';
}

// Redirect to phone call
function redirectToCall() {
    // Replace with your actual call link
    window.location.href = 'tel:1234567890';
}

// Initialize the date picker when the DOM content is loaded
document.addEventListener('DOMContentLoaded', initializeDatePicker);
    </script>
</body>
</html>
