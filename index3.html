<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link href="floatingicon.css" rel="stylesheet"> 
    <link href="index.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <!-- <script type="text/javascript" src="time.js" ></script> -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Varma Clinic</title>
   

</head>
<body>
    
    <div class="form-container">
        <a href="index1.html" class="next-button" style="background-color:  rgb(2, 7, 55); color: whitesmoke;">Next</a>
        <img src="images/logo.png" width="620" height="100" alt="Form Logo" />
        <h1>Book Your Appointment</h1>
        <form id="appointmentForm">
            <div class="form-group">
                <label for="name">Patient Name:</label>
                <input type="text" id="name" name="name" required placeholder="Enter name" oninput="validateForm()">
                <small id="nameError" class="error-message">Please enter a valid name (alphabets only).</small>
            </div>
            <div class="form-group">
                <label for="age">Age:</label>
                <input type="number" id="age" name="age" required placeholder="Enter age" oninput="validateForm()">
                <small id="ageError" class="error-message">Please enter a valid age (1-110 and up to 3 digits).</small>
            </div>
            <div class="form-group">
                <label for="gender" style="margin-top: 20px;">Gender:</label>
                <select id="gender" name="gender" required onchange="validateForm()">
                    <option value="">Please Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Transgender">Transgender</option>
                </select>
            </div>
            <div class="form-group" style="margin-top: 20px;">
                <label for="phone" style="margin-top: 20px;">Mobile Number:</label>
                <input type="text" class="form-control" name="Mobile number" id="phone" placeholder=""
                       maxlength="10" required>
                <small id="phoneError" class="error-message" style="display:none; color: red;">
                    Phone number must be 10 digits long and start with a digit between 6-9.
                </small>
            </div>
            
            
            <div class="form-group">
                <label style="margin-top: 20px; padding-bottom: 15px;">Reason For Your Appointment:</label>
                <div class="reason-container">
                    <!-- Existing checkbox items -->
                    <div class="checkbox-item">
                        <label>
                            <input type="checkbox" name="reason" value="Fever" onchange="validateForm()"> Fever
                        </label>
                    </div>
                    <div class="checkbox-item">
                        <label>
                            <input type="checkbox" name="reason" value="Cold/Cough" onchange="validateForm()"> Cold/Cough
                        </label>
                    </div>
                    <div class="checkbox-item">
                        <label>
                            <input type="checkbox" name="reason" value="Vomiting" onchange="validateForm()"> Vomiting
                        </label>
                    </div>
                    <div class="checkbox-item">
                        <label>
                            <input type="checkbox" name="reason" value="Head Ache" onchange="validateForm()"> Head Ache
                        </label>
                    </div>
                    <div class="checkbox-item">
                        <label>
                            <input type="checkbox" name="reason" value="Diarrhoea/Dysentery" onchange="validateForm()"> Diarrhoea/Dysentery
                        </label>
                    </div>
                    <div class="checkbox-item">
                        <label>
                            <input type="checkbox" name="reason" value="Stomach Pain" onchange="validateForm()"> Stomach Pain
                        </label>
                    </div>
                    <div class="checkbox-item">
                        <label>
                            <input type="checkbox" name="reason" value="Body pain/Joint pain" onchange="validateForm()"> Body pain/Joint pain
                        </label>
                    </div>
                    <div class="checkbox-item others-input-container">
                        <label>
                            <input type="checkbox" name="reason" value="Others" onchange="toggleOthersInput()"> Others
                        </label>
                        <input type="text" id="othersInput" maxlength="20" oninput="validateOthersInput()" style="display:none;" placeholder="Type here...">
                    </div>
                </div> 
            </div>
            
        
            <div class="form-group">
                <label for="date">Select Date:</label>
                <input type="date" id="date" onchange="loadSlots()">
                <div id="available-slots">
                    <!-- Available slots will be dynamically loaded here -->
                </div>
            </div>
            <!-- <div class="form-group">
                <label for="paymentQR" style="margin-top: 20px;margin-left: 54px;">Scan Me To Complete Your Payment</label>
                <img src="images/webQR.jpg" alt="Payment QR Code" id="paymentQR" style="width: 150px; height: 150px; margin-top: 10px;">
            </div> -->
         
            <div class="appointment-container">
                <div class="appointment-heading">Book your appointment via</div>
                <div class="appointment-buttons">
                    <button type="button" id="whatsappButton" onclick="redirectToWhatsApp()" disabled>
                        <i class="fab fa-whatsapp" style="color: #25D366;"></i> <!-- WhatsApp Green -->
                    </button>
                    <button type="button" id="smsButton" onclick="redirectToSMS()" disabled>
                        <i class="fas fa-sms" style="color: #007BFF;"></i> <!-- SMS Blue -->
                    </button>
                    <button type="button" id="emailButton" onclick="redirectToEmail()" disabled>
                        <i class="fas fa-envelope" style="color: #FF5722;"></i> <!-- Email Orange -->
                    </button>
                    <button type="button" id="callButton" onclick="redirectToCall()" enabled>
                        <i class="fas fa-phone" style="color: #4CAF50;"></i> <!-- Phone Green -->
                    </button>
                </div>
                 <div class="form-group">
                    <label for="paymentQR" style="margin-top: 20px;">Scan Me To Complete Your Payment</label>
                    <img src="images/webQR.jpg" alt="Payment QR Code" id="paymentQR" style="width: 150px; height: 150px; margin-top: 10px;">
                </div> 
            </div>
            </form>


    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            async function fetchBlockedDates() {
                try {
                    const response = await fetch('https://raw.githubusercontent.com/Balagangadara/calender/main/unavailable-dates.json');
                    if (!response.ok) {
                        throw new Error('Network response was not ok.');
                    }
                    const data = await response.json();
                    return data.dates; // Ensure this matches the JSON structure
                } catch (error) {
                    console.error('Error fetching blocked dates:', error);
                    return [];
                }
            }

            function formatDate(date) {
                return date.toISOString().split('T')[0];
            }

            async function initializeDatePicker() {
                const blockedDates = await fetchBlockedDates();
                const today = new Date();
                const nextSevenDays = new Date(today);
                nextSevenDays.setDate(today.getDate() + 7);

                const datePicker = flatpickr("#appointment_date", {
                    dateFormat: "Y-m-d",
                    minDate: formatDate(today),
                    maxDate: formatDate(nextSevenDays),
                    disable: blockedDates,
                    onChange: function(selectedDates) {
                        validateForm();
                    },
                });

                document.getElementById('calendar-icon').addEventListener('click', () => {
                    datePicker.open();
                });
            }

            initializeDatePicker();
        });

function validatePhoneNumber() {
    const phoneInput = document.getElementById("phone");
    const phoneError = document.getElementById("phoneError");

    // Get the input value and remove all non-numeric characters
    let phoneValue = phoneInput.value;
    phoneValue = phoneValue.replace(/\D/g, ''); // Keep only digits

    // Validate the cleaned value
    const phonePattern = /^[6-9][0-9]{9}$/; // Start with 6-9

    if (phonePattern.test(phoneValue)) {
        phoneInput.value = phoneValue; // Update input value to cleaned value
        phoneError.style.display = "none"; // Hide error message if valid
    } else {
        phoneError.style.display = "block"; // Show error message if invalid
        phoneError.textContent = "Phone number must be 10 digits long and start with a digit between 6-9.";
    }
}

// Add event listener for real-time validation and restriction
document.getElementById("phone").addEventListener("input", function() {
    // Enforce numeric input only
    let value = this.value.replace(/\D/g, '');

    // Restrict starting digit to be between 6 and 9
    if (value.length > 0 && value[0] >= '0' && value[0] <= '5') {
        value = ''; // Clear input if starting digit is between 0-5
    }

    this.value = value; // Update input value to cleaned and restricted value
    validatePhoneNumber();
});


       
        function restrictAgeInput() {
            const ageInput = document.getElementById("age");
            const ageError = document.getElementById("ageError");
            let value = ageInput.value;

            value = value.replace(/\D/g, '');

            const age = parseInt(value, 10);

            if (value.length > 3 || age < 1 || age > 110) {
                ageError.style.display = "block";
                ageInput.value = '';
            } else {
                ageError.style.display = "none";
                ageInput.value = value;
            }
        }

        function restrictNameInput() {
    const nameInput = document.getElementById("name");
    const nameError = document.getElementById("nameError");
    let value = nameInput.value;

    // Remove any non-letter characters and extra spaces
    value = value.replace(/[^a-zA-Z\s]/g, '');
    nameInput.value = value;

    // Check the length of the cleaned value
    const letterOnlyValue = value.replace(/\s/g, ''); // Remove spaces for length check
    if (letterOnlyValue.length < 3) {
        nameError.style.display = "block";
        nameError.textContent = "Name must be at least 3 letters.";
    } else {
        nameError.style.display = "none";
    }
}


        // function validateForm() {
        //     const name = document.getElementById("name").value.trim();
        //     const age = document.getElementById("age").value.trim();
        //     const gender = document.getElementById("gender").value;
        //     const phone = document.getElementById("phone").value.trim();
        //     const reason = document.getElementById("reason").value;
        //     const appointmentDate = document.getElementById("appointment_date").value;
        //     const timeSlot = document.getElementById("time_slot").value;

        //     const nameValid = name !== "" && /^[a-zA-Z\s]+$/.test(name);
        //     const ageValid = age !== "" && /^[1-9][0-9]?$|^1[0-1][0-9]$/.test(age);
        //     const phoneValid = /^[6-9][0-9]{9}$/.test(phone);
        //     const genderValid = gender !== "";
        //     const reasonValid = reason !== "";
        //     const appointmentDateValid = appointmentDate !== "";
        //     const timeSlotValid = timeSlot !== "";

        //     const allValid = nameValid && ageValid && phoneValid && genderValid && reasonValid && appointmentDateValid && timeSlotValid;

        //     document.getElementById("whatsappButton").disabled = !allValid;
        //     document.getElementById("smsButton").disabled = !allValid;
        //     document.getElementById("emailButton").disabled = !allValid;
        //     document.getElementById("callButton").disabled = !allValid;
        //     document.getElementById("formspreeButton").disabled = !allValid;
        // }
        function validateForm() {
    const name = document.getElementById("name").value.trim();
    const age = document.getElementById("age").value.trim();
    const gender = document.getElementById("gender").value;
    const phone = document.getElementById("phone").value.trim();
    const reason = Array.from(document.querySelectorAll('input[name="reason"]:checked')).map(cb => cb.value);
    const appointmentDate = document.getElementById("date").value;
    const timeSlot = localStorage.getItem('selectedSlotId');

    const nameValid = name !== "" && /^[a-zA-Z\s]+$/.test(name);
    const ageValid = age !== "" && /^[1-9][0-9]?$|^1[0-1][0-9]$/.test(age);
    const phoneValid = /^[6-9][0-9]{9}$/.test(phone);
    const genderValid = gender !== "";
    const reasonValid = reason.length > 0;
    const appointmentDateValid = appointmentDate !== "";
    const timeSlotValid = !!timeSlot;

    const allValid = nameValid && ageValid && phoneValid && genderValid && reasonValid && appointmentDateValid && timeSlotValid;

    document.getElementById("whatsappButton").disabled = !allValid;
    document.getElementById("smsButton").disabled = !allValid;
    document.getElementById("emailButton").disabled = !allValid;
    document.getElementById("callButton").disabled = !allValid;
}

        document.getElementById("name").addEventListener("input", function() {
            restrictNameInput();
            validateForm();
        });

        document.getElementById("age").addEventListener("input", function() {
            restrictAgeInput();
            validateForm();
        });

        document.getElementById("phone").addEventListener("input", function() {
            validatePhoneNumber();
            validateForm();
        });

        // document.getElementById("gender").addEventListener("change", validateForm);
        // document.getElementById("reason").addEventListener("change", validateForm);
        // document.getElementById("appointment_date").addEventListener("change", validateForm);
        // document.getElementById("time_slot").addEventListener("change", validateForm);
document.getElementById("name").addEventListener("input", validateForm);
document.getElementById("age").addEventListener("input", validateForm);
document.getElementById("phone").addEventListener("input", validateForm);
document.getElementById("gender").addEventListener("change", validateForm);
document.getElementById("date").addEventListener("change", loadSlots);
document.getElementById("appointment_date").addEventListener("change", validateForm);


        function validateOthersInput() {
    const othersInput = document.getElementById('othersInput');
    const value = othersInput.value;

    // Remove all non-letter and non-space characters
    const sanitizedValue = value.replace(/[^a-zA-Z\s]/g, '');
    
    // Limit the length to 20 characters
    if (sanitizedValue.length > 20) {
        othersInput.value = sanitizedValue.substring(0, 20);
    } else {
        othersInput.value = sanitizedValue;
    }
}


    </script>

       <style>   .form-container {
        width: 80%; /* Adjust this percentage as needed */
        max-width: 400px; /* You can set a maximum width if desired */
        margin: 0 auto; /* Centers the container */
        padding: 20px; /* Optional: Adds padding inside the container */
    }
    @media (max-width: 768px) {
        .form-container {
            width: 90%; /* Adjust the width for smaller screens */
            padding: 15px; /* Adjust padding for smaller screens */
        }
    }
    .slot button.dark-grey {
    background-color: darkgrey; /* Previously blocked slots */
}
/* Available slot button style */
.slot button.available {
    background-color:  rgb(2, 7, 55); /* White background for available slots */
    color: #fff; /* Black text */
}

/* Booked slot button style */
.slot button.booked {
    background-color: #928e8e; /* Light grey background for booked slots */
    color: #fff; /* Grey text */
}

/* Selected slot button style */
.slot button.selected {
    background-color: #404040; /* Dark grey background for selected slots */
    color: #ffffff; /* White text */
}

</style>
 
  <script>
  
// function handleSlotClick(slotId, slotTime) {
//     const dateInput = document.getElementById('date').value;
//     if (!dateInput) {
//         alert('Please select a date.');
//         return;
//     }

//     const formattedDate = formatDateToYYYYMMDD(dateInput);
//     let selectedSlotId = localStorage.getItem('selectedSlotId');

//     // Update localStorage with selected slot ID
//     if (selectedSlotId !== slotId) {
//         localStorage.setItem('selectedSlotId', slotId);
//         updateSlotButtons(formattedDate, slotId, slotTime); // Update button states to reflect the selection
//     }
// }


  </script>

  <script>
   

   async function loadSlots() {
    const dateInput = document.getElementById('date').value;
    if (!dateInput) {
        alert('Please select a date.');
        return;
    }

    const formattedDate = formatDateToYYYYMMDD(dateInput);
    console.log(`Fetching slots for date: ${formattedDate}`); // Debug log

    try {
        const response = await fetch('https://raw.githubusercontent.com/Balagangadara/timeblock/main/time.json');

        if (!response.ok) {
            throw new Error(`Network response was not ok: ${response.statusText}`);
        }

        const data = await response.json();
        console.log('Data fetched:', data); // Debug log

        const dayData = data[formattedDate];
        if (!dayData || !Array.isArray(dayData)) {
            document.getElementById('available-slots').innerHTML = '<p>No time slots available for this date.</p>';
            return;
        }

        const container = document.getElementById('available-slots');
        container.innerHTML = '';

        let bookedSlots = JSON.parse(localStorage.getItem('bookedSlots') || '{}');
        bookedSlots = bookedSlots[formattedDate] || [];

        let selectedSlotId = localStorage.getItem('selectedSlotId');

        // Get current date and time
        const now = new Date();
        const currentTime = now.getHours() * 100 + now.getMinutes(); // Current time in HHMM format
        const today = formatDateToYYYYMMDD(now);

        let firstAvailableSlotId = null;

        dayData.forEach(slot => {
            if (!slot || typeof slot !== 'object') {
                console.warn('Invalid slot data:', slot);
                return;
            }
            const slotTime = parseInt(slot.time.replace(':', ''), 10); // Convert slot time to HHMM format
            const isPastSlot = (formattedDate === today && slotTime < currentTime) || (formattedDate !== today && formattedDate < today);

            const slotDiv = document.createElement('div');
            slotDiv.className = 'slot';

            const slotButton = createSlotButton(slot, bookedSlots, selectedSlotId, isPastSlot);
            if (isPastSlot) {
                slotButton.classList.add('past');
            }

            slotDiv.appendChild(slotButton);
            container.appendChild(slotDiv);

            // Automatically select the first available slot if none is selected
            if (!selectedSlotId && !bookedSlots.includes(slot.id)) {
                if (firstAvailableSlotId === null) {
                    firstAvailableSlotId = slot.id; // Set the first available slot
                }
            }
        });

        // Set the first available slot as selected if none is selected
        if (!selectedSlotId && firstAvailableSlotId !== null) {
            selectedSlotId = firstAvailableSlotId;
            localStorage.setItem('selectedSlotId', selectedSlotId);
            updateSlotButtons(formattedDate, selectedSlotId, getSlotTimeById(firstAvailableSlotId));
        }

        loadFormData();
        updateButtonStates();

    } catch (error) {
        console.error('Error loading slots:', error);
        document.getElementById('available-slots').innerHTML = `<p>Error loading slots: ${error.message}. Please try again later.</p>`;
    }
}

function createSlotButton(slot, bookedSlots, selectedSlotId, isPastSlot) {
    const slotButton = document.createElement('button');
    const isBooked = slot.booked || bookedSlots.includes(slot.id) || isPastSlot;

    // Set the button class based on whether the slot is booked, selected, or available
    if (slot.id === selectedSlotId) {
        slotButton.className = 'selected'; // For selected slot
    } else {
        slotButton.className = isBooked ? 'booked' : 'available';
    }
    slotButton.disabled = isBooked;

    slotButton.textContent = slot.time;
    slotButton.dataset.slotId = slot.id;
    slotButton.dataset.slotTime = slot.time;

    slotButton.addEventListener('click', function (event) {
        event.preventDefault(); // Prevent default behavior
        event.stopPropagation(); // Prevent event bubbling

        if (!isBooked) {
            handleSlotClick(slot.id, slot.time);
        }
    });

    return slotButton;
}

function getSlotTimeById(slotId) {
    const slots = document.querySelectorAll('#available-slots .slot button');
    for (let button of slots) {
        if (button.dataset.slotId === slotId.toString()) {
            return button.dataset.slotTime;
        }
    }
    return '';
}

function handleSlotClick(slotId, slotTime) {
    const dateInput = document.getElementById('date').value;
    if (!dateInput) {
        alert('Please select a date.');
        return;
    }

    const formattedDate = formatDateToYYYYMMDD(dateInput);
    let selectedSlotId = localStorage.getItem('selectedSlotId');
    let bookedSlots = JSON.parse(localStorage.getItem('bookedSlots') || '{}');
    bookedSlots = bookedSlots[formattedDate] || [];
    if (selectedSlotId !== slotId) {
        localStorage.setItem('selectedSlotId', slotId);
        updateSlotButtons(formattedDate, slotId, slotTime); // Update button states to reflect the selection
     }
 }

//     // Check if the slot is already booked
//     if (!bookedSlots.includes(slotId)) {
//         bookedSlots.push(slotId);
//         localStorage.setItem('bookedSlots', JSON.stringify({ ...bookedSlots, [formattedDate]: bookedSlots }));
//         localStorage.setItem('selectedSlotId', slotId);
//         updateSlotButtons(formattedDate, slotId, slotTime); // Update button states
//         saveFormData(); // Save form data whenever a slot is booked
//         updateButtonStates(); // Update button states after slot selection
//     }
// }


function updateSlotButtons(date, slotId, slotTime) {
    const slots = document.querySelectorAll('#available-slots .slot button');
    slots.forEach(button => {
        const buttonId = button.dataset.slotId;
        if (buttonId === slotId.toString()) {
            button.disabled = false; // Always enable the selected slot
            button.className = 'selected'; // Apply selected class
            button.textContent = slotTime; // Show only time for the selected slot
        } else {
            // Restore the button to its available state if it’s not selected
            button.className = button.disabled ? 'booked' : 'available';
            button.textContent = button.dataset.slotTime; // Show available slot time
        }
    });
}



function updateButtonStates() {
    const bookedSlots = JSON.parse(localStorage.getItem('bookedSlots') || '{}');
    const dateInput = document.getElementById('date')?.value;
    const name = document.getElementById('name')?.value.trim();
    const phone = document.getElementById('phone')?.value.trim();
    const selectedSlotId = localStorage.getItem('selectedSlotId');
    


    if (dateInput) {
        const formattedDate = formatDateToYYYYMMDD(dateInput);
        const slots = document.querySelectorAll('#available-slots .slot button');
        const dateBookedSlots = bookedSlots[formattedDate] || [];
        const selectedSlotId = localStorage.getItem('selectedSlotId');

       
            slots.forEach(button => {
            const buttonId = button.dataset.slotId;
            const isBooked = bookedSlots[formattedDate] && bookedSlots[formattedDate].includes(parseInt(buttonId, 10));
        
            const buttonIdMatch = button.getAttribute('onclick')?.match(/(\d+)/);
            if (buttonIdMatch) {
                const slotId = parseInt(buttonIdMatch[1], 10);
                const slotTime = button.textContent.match(/\((.*?)\)/)?.[1] || ''; // Extract time
                // const isBooked = bookedSlots[formattedDate] && bookedSlots[formattedDate].includes(slotId);
                // // button.disabled = isBooked;
                 button.className = isBooked ? 'booked' : 'available';
                button.textContent = isBooked ? `Booked (${slotTime})` : `Available (${slotTime})`;
            }
        });

        // Enable or disable communication buttons based on form and slot selection
        if (isFormComplete() && selectedSlotId) {
            enableCommunicationButtons();
        } else {
            disableCommunicationButtons();
        }
    }
}

function isFormComplete() {
    const name = document.getElementById('name')?.value.trim();
    const age = document.getElementById('age')?.value.trim();
    const gender = document.getElementById('gender')?.value;
    const phone = document.getElementById('phone')?.value.trim();
    const reasons = Array.from(document.querySelectorAll('input[name="reason"]:checked')).map(cb => cb.value);
    const date = document.getElementById('date')?.value;
    const selectedSlot = localStorage.getItem('selectedSlotId');

    return name.length >= 3 && age && gender && phone.length >= 10 && reasons.length > 0 && date && selectedSlot;
}

function saveFormData() {
    const formData = {
        name: document.getElementById('name')?.value.trim(),
        age: document.getElementById('age')?.value.trim(),
        gender: document.getElementById('gender')?.value,
        phone: document.getElementById('phone')?.value.trim(),
        reasons: Array.from(document.querySelectorAll('input[name="reason"]:checked')).map(cb => cb.value),
        date: document.getElementById('date')?.value // Save the raw date format
    };
    localStorage.setItem('formData', JSON.stringify(formData));
}

function loadFormData() {
    const formData = JSON.parse(localStorage.getItem('formData'));
    if (formData) {
        document.getElementById('name').value = formData.name;
        document.getElementById('age').value = formData.age;
        document.getElementById('gender').value = formData.gender;
        document.getElementById('phone').value = formData.phone;
        document.getElementById('date').value = formData.date; // Load the raw date format

        // Check the checkboxes based on saved data
        document.querySelectorAll('input[name="reason"]').forEach(cb => {
            if (formData.reasons.includes(cb.value)) {
                cb.checked = true;
            }
        });
    }
    updateButtonStates(); // Check button states when loading form data
}

function enableCommunicationButtons() {
    document.getElementById('whatsappButton').disabled = false;
    document.getElementById('smsButton').disabled = false;
    document.getElementById('emailButton').disabled = false;
    document.getElementById('callButton').disabled = false;
}

function disableCommunicationButtons() {
    document.getElementById('whatsappButton').disabled = true;
    document.getElementById('smsButton').disabled = true;
    document.getElementById('emailButton').disabled = true;
    document.getElementById('callButton').disabled = true;
}

function formatDateToYYYYMMDD(dateInput) {
    const date = new Date(dateInput);
    if (isNaN(date.getTime())) return 'Invalid Date';
    const year = date.getFullYear();
    const month = ('0' + (date.getMonth() + 1)).slice(-2);
    const day = ('0' + date.getDate()).slice(-2);
    return `${year}-${month}-${day}`;
}

function formatDateToDDMMYYYY(dateInput) {
    const date = new Date(dateInput);
    if (isNaN(date.getTime())) return 'Invalid Date';
    const day = ('0' + date.getDate()).slice(-2);
    const month = ('0' + (date.getMonth() + 1)).slice(-2);
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
}

function getSelectedTimeSlot() {
    const slotId = localStorage.getItem('selectedSlotId');
    if (slotId) {
        const slots = document.querySelectorAll('#available-slots .slot button');
        for (let button of slots) {
            if (button.dataset.slotId === slotId) {
                return button.dataset.slotTime;
            }
        }
    }
    return 'No time selected';
}

function getFormattedMessage() {
    const formData = JSON.parse(localStorage.getItem('formData'));
    if (!formData) {
        alert('Form data is missing.');
        return '';
    }

    const { name, age, gender, phone, reasons, date } = formData;
    const formattedDate = formatDateToDDMMYYYY(date);
    const time = getSelectedTimeSlot();

    // Join reasons array into a comma-separated string
    let reasonsString = reasons.join(', ');

    // Include "Others" input value if the checkbox is checked and "Others" is in the reasons
    const othersInput = document.getElementById('othersInput');
    const othersCheckbox = document.querySelector('input[name="reason"][value="Others"]');
    if (othersCheckbox.checked && othersInput.value.trim()) {
        if (reasons.includes('')) {
            reasonsString += `, ${othersInput.value}`;
        } else {
            reasonsString += `, ${othersInput.value}`;
        }
    }

    return `Name: ${name}\nAge: ${age}\nGender: ${gender}\nMobile Number: ${phone}\nReason For Appointment: ${reasonsString}\nAppointment Date: ${formattedDate}\nTime Slot: ${time}`;
}

function redirectToWhatsApp() {
    const message = getFormattedMessage();
    const url = `https://wa.me/9094852653?text=${encodeURIComponent(message)}`;
    clearFormData(); // Clear form data after redirect
    window.open(url, '_blank');
}

function redirectToSMS() {
    const message = getFormattedMessage();
    const url = `sms:9094852653?body=${encodeURIComponent(message)}`;
    clearFormData(); // Clear form data after redirect
    window.open(url, '_blank');
}

function redirectToEmail() {
    const subject = 'Appointment Details';
    const body = getFormattedMessage();
    const url = `mailto:balavarmaclinic@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    clearFormData(); // Clear form data after redirect
    window.open(url, '_blank');
}

function redirectToCall() {
    const phoneNumber = '9094852653'; // Hardcoded phone number
    const url = `tel:${encodeURIComponent(phoneNumber)}`;
    clearFormData(); // Clear form data after redirect
    window.open(url, '_blank');
}

function clearFormData() {
    // Clear localStorage data
    localStorage.removeItem('formData');
    localStorage.removeItem('selectedSlotId');
    localStorage.removeItem('bookedSlots');
    
    // Clear form fields
    document.getElementById('name').value = '';
    document.getElementById('age').value = '';
    document.getElementById('gender').value = '';
    document.getElementById('phone').value = '';
    document.getElementById('date').value = '';

    // Uncheck all reason checkboxes
    document.querySelectorAll('input[name="reason"]').forEach(cb => cb.checked = false);
    
    // Disable communication buttons
    disableCommunicationButtons();
}

function toggleOthersInput() {
    const othersCheckbox = document.querySelector('input[name="reason"][value="Others"]');
    const othersInput = document.getElementById('othersInput');
    
    if (othersCheckbox.checked) {
        othersInput.style.display = 'inline-block';
        othersInput.focus();
    } else {
        othersInput.style.display = 'none';
        othersInput.value = ''; // Clear the input field if checkbox is unchecked
    }
}

document.addEventListener('DOMContentLoaded', (event) => {
document.querySelectorAll('#available-slots button').forEach(button => {
    button.addEventListener('click', handleClick);
});
});

function handleClick(event) {
alert('Button clicked!');
}


document.addEventListener('DOMContentLoaded', () => {
    setDateInputMinDate();
});

function setDateInputMinDate() {
    const dateInput = document.getElementById('date');
    if (!dateInput) return;

    // Get today's date in YYYY-MM-DD format
    const today = new Date().toISOString().split('T')[0];
    dateInput.setAttribute('min', today);
}

  </script>

</body>
</html>
